"use strict";
/**
* @license HTTP Auth Interceptor Module for AngularJS
* (c) 2012 Witold Szczerba
* License: MIT
*/
(function(){angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(n,t){return{loginConfirmed:function(i,r){var u=r||function(n){return n};n.$broadcast("event:auth-loginConfirmed",i);t.retryAll(u)},loginCanceled:function(i){n.$broadcast("event:auth-loginCanceled",i);t.rejectAll()}}}]).config(["$httpProvider",function(n){var t=["$rootScope","$q","httpBuffer",function(n,t,i){var r={};return r.response=function(r){if(r.status===401&&!r.config.ignoreAuthModule){var u=t.defer();return i.append(r,u),n.$broadcast("event:auth-loginRequired"),u.promise}return r},r}];n.interceptors.push(t)}]);angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(n){function r(t,r){function u(n){r.resolve(n)}function f(n){r.reject(n)}i=i||n.get("$http");i(t).then(u,f)}var t=[],i;return{append:function(n,i){t.push({response:n,deferred:i})},retryAll:function(n){for(var i=0;i<t.length;++i)r(n(t[i].response.config),t[i].deferred);t=[]},rejectAll:function(){for(var n=0;n<t.length;++n)t[n].deferred.reject(t[n].response);t=[]}}}])})(),function(n,t){n.module("interceptors",[]).config(["$httpProvider",function(n){n.interceptors.push("errorHttpInterceptor");n.interceptors.push("httpAjaxInterceptor")}]).factory("errorHttpInterceptor",["$q",function(n){return{response:function(i){return i.status==401?i:i.status==400&&i.data&&i.data.message?(t.error(i.data.message),n.reject(i)):i.status===0?(t.error("Server connection lost"),n.reject(i)):i.status>=400&&i.status<500?(t.error("Server was unable to find what you were looking for... Sorry!!"),n.reject(i)):i}}}]).factory("httpAjaxInterceptor",["$q","$location","$rootScope","$timeout",function(n,t,i,r){function s(){u.push({});u.length==1&&(o=r(function(){u.length&&i.$broadcast("event:ajax-show")},500))}function e(){u.pop();u.length==0&&(f=r(function(){u.length==0&&(i.$broadcast("event:ajax-hide"),f&&r.cancel(f))},500))}var u=[],o=null,f=null;return{request:function(t){return s(),t||n.when(t)},response:function(t){return e(),t||n.when(t)},responseError:function(t){return e(),t||n.when(t)}}}])}(angular,toastr),function(n,t){var i=n.module("services",[]);i.factory("$auth",["$q","$http","$path",function(n,t,i){function f(n,i){var r="Bearer "+n;return delete t.defaults.headers.common.Authorization,t.defaults.headers.common.Authorization=r,sessionStorage.accessToken=n,i&&(localStorage.accessToken=n),r}function s(){sessionStorage.removeItem("accessToken");localStorage.removeItem("accessToken");delete t.defaults.headers.common.Authorization}var e=i("api/Account/Profile"),o=i("api/Account/Token"),r={},u;return r.getUserName=function(){return u},r.isAuthenticated=function(){return u&&u.length},r.loadSaved=function(){var i=n.defer(),r=sessionStorage.accessToken||localStorage.accessToken;return r?(f(r),t.get(e,{ignoreAuthModule:!0}).success(function(n){u=n.userName;i.resolve({userName:n.userName})}).error(function(){s();i.reject()})):i.reject(),i.promise},r.login=function(i,r,u){var e=n.defer();return t.post(o,{userName:i,password:r}).success(function(n){var t=f(n.accessToken,u);e.resolve({userName:n.userName,Authorization:t})}).error(function(){e.reject()}),e.promise},r}]);i.factory("$safeApply",function(){return function(n,t){var i=n.$root?n.$root.$$phase:null;i=="$apply"||i=="$digest"?t&&n.$eval(t):t?n.$apply(t):n.$apply()}});i.factory("$path",function(){var t=window.location.href,i=t.indexOf("#"),n=t;return i>0&&(n=t.substr(0,i)),n[n.length-1]!="/"&&(n=n+"/"),function(t){return n+t}});i.factory("$signalR",["$rootScope",function(n){var i=n.$new(),r=t.connection.chessHub;return r.client.broadcastMessage=function(){i.$emit("chessMoveEvent",chessMoveEvent)},t.connection.hub.start(),i}])}(window.angular,window.jQuery),function(n){var t=n.module("resources",[]);t.factory("TodoItem",["$resource","$path",function(n,t){return n(t("api/TodoItem/:id"),{id:"@Id"},{update:{method:"PUT"}})}]);t.factory("TodoList",["$resource","$path",function(n,t){return n(t("api/TodoList/:id/:action"),{id:"@Id"},{todos:{method:"GET",isArray:!0,params:{action:"Todos"}}})}])}(window.angular),function(n){var t=n.module("directives",[]);t.directive("busyIndicator",["$rootScope",function(n){return{restrict:"A",link:function(t,i){var r=null;n.$on("event:ajax-show",function(){r||(r=i[0].innerHTML,i[0].innerHTML="Loading...")});n.$on("event:ajax-hide",function(){i[0].innerHTML=r||i[0].innerHTML;r=null})}}}]);t.directive("authDialog",function(){var n=0;return{restrict:"A",link:function(t,i){function u(){n==0&&r.modal("show");n++}function f(){n>0&&r.modal("hide")}function e(){n--;n>0&&(n=0,u())}var r=$(i);r.modal({backdrop:!1,keyboard:!1,show:!1});$(i).on("hidden.bs.modal",e);t.$on("event:auth-loginRequired",u);t.$on("event:auth-loginConfirmed",f);t.$on("event:auth-loginCanceled",f)}}});t.directive("onFocus",function(){return{restrict:"A",link:function(n,t,i){t.bind("focus",function(){n.$apply(i.onFocus)})}}}).directive("onBlur",function(){return{restrict:"A",link:function(n,t,i){t.bind("blur",function(){n.$apply(i.onBlur)})}}}).directive("onEnter",function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.onEnter)}),t.preventDefault())})}}).directive("selectedWhen",function(){return function(n,t,i){n.$watch(i.selectedWhen,function(n){n&&t.select()})}})}(window.angular),function(n){var t=n.module("controllers",[]);t.controller("HomeCtrl",["$scope","$signalR",function(n,t){n.title="Home";n.$watch("game",function(){n.game&&(n.history=n.game.history)});n.onBoardChanged=function(){};t.$on("chessMoveEvent",function(n,t){alert(t)});n.$on("$viewContentLoaded",function(){})}]);t.controller("TodosCtrl",["$scope","$safeApply","TodoList","TodoItem",function(n,t,i,r){n.newTodoListName="";n.todoLists=i.query();n.expand=function(n){n.todoItems||(n.todoItems=i.todos({id:n.id}))};n.addTodoList=function(){var r=new i;r.title=n.newTodoListName;r.$save(function(i){t(n,function(){n.todoLists.push(i);n.newTodoListName=""})})};n.removeTodoList=function(t){var r=t.id;i.remove(t,function(){for(var t=0;t<n.todoLists.length;t++)if(n.todoLists[t].id==r){n.todoLists.splice(t,1);break}})};n.addTodoItem=function(i){var u=new r;u.title=i.newTodoItemName;u.todoListId=i.id;u.$save(function(r){t(n,function(){i.todoItems.push(r);i.newTodoItemName=""})})};n.saveTodoItem=function(n){r.update(n)};n.removeTodoItem=function(n,t){var i=t.id;r.remove(t,function(){for(var t=0;t<n.todoItems.length;t++)if(n.todoItems[t].id==i){n.todoItems.splice(t,1);break}})}}]);t.controller("AboutCtrl",["$scope",function(n){n.title="About"}]);t.controller("SettingsCtrl",["$scope",function(n){n.title="Settings"}]);t.controller("NavCtrl",["$scope","$location",function(n,t){n.getClass=function(n){var i=t.path();return i.indexOf(n)===0?"active":""}}]);t.controller("LoginCtrl",["$scope","$safeApply","authService","$rootScope","$auth",function(n,t,i,r,u){n.userName="";n.password="";n.rememberMe=!1;n.signIn=function(){u.login(n.userName,n.password,n.rememberMe).then(function(u){t(n,function(){r.userName=u.userName});i.loginConfirmed({user:u.userName},function(n){return n.headers.Authorization=u.Authorization,n})})};n.cancel=function(){i.loginCanceled()}}]);t.controller("LogsCtrl",["$scope","$safeApply","$signalR",function(n,t,i){n.logs=[];var r=[];r.FATAL="alert alert-error repeat-item";r.ERROR="alert alert-error repeat-item";r.WARN="alert alert-info repeat-item";r.INFO="alert alert-success repeat-item";r.DEBUG="alert alert-info repeat-item";i.$on("loggedEvent",function(i,u){t(n,function(){u.class=r[u.Level];n.logs.splice(0,0,u)})});n.clearLogs=function(){n.logs.length=0}}])}(window.angular),function(n){var t=n.module("filters",[]);t.filter("turnnote",function(){return function(n){switch(n){case"w":return"White To Move";case"b":return"Black To Move"}}})}(window.angular),function(n,t,i){i.options.closeButton=!0;i.options.newestOnTop=!1;i.options.positionClass="toast-bottom-right";$(n).resize(function(){var i=$(n).height()-300,t=$(n).width(),r=t>i?i/t:t/i;$("#content").width(t*r)});$(n).trigger("resize");n.app=t.module("app",["ngRoute","ngAnimate","ngResource","services","directives","resources","controllers","filters","http-auth-interceptor","interceptors","nywton.chessboard","nywton.chess"]);var r=function(n){i.error(n.message||n)};app.value("$exceptionHandler",r);app.config(["$routeProvider","$locationProvider","$logProvider",function(n,t,i){n.when("/home",{templateUrl:"App/views/home.html",controller:"HomeCtrl"}).when("/todos",{templateUrl:"App/views/todos.html",controller:"TodosCtrl",resolve:{authentication:["$http",function(n){return n.get("api/Account/Ping")}]}}).when("/about",{templateUrl:"App/views/about.html",controller:"AboutCtrl"}).when("/settings",{templateUrl:"App/views/settings.html",controller:"SettingsCtrl",resolve:{authentication:["$http",function(n){return n.get("api/Account/Ping")}]}}).when("/logs",{templateUrl:"App/views/logs.html",controller:"LogsCtrl"}).otherwise({redirectTo:"/home"});t.html5Mode(!1).hashPrefix("!");i.debugEnabled(!0)}]);app.run(["$rootScope","$location","$window","$auth",function(n,t,i,r){n.today=new Date;r.loadSaved().then(function(t){n.userName=t.userName});n.$on("$routeChangeError",function(n,r,u){u?t.path(u.originalPath):i.location.reload()})}])}(window,angular,toastr);
/*!
 * chessboard.js v0.3.0
 *
 * Copyright 2013 Chris Oakman
 * Released under the MIT license
 * http://chessboardjs.com/license
 *
 * Date: 10 Aug 2013
 */
(function(){function e(t){if(typeof t!="string")return!1;var i=t.split("-");return i.length!==2?!1:n(i[0])===!0&&n(i[1])===!0}function n(n){return typeof n!="string"?!1:n.search(/^[a-h][1-8]$/)!==-1}function o(n){return typeof n!="string"?!1:n.search(/^[bw][KQRNBP]$/)!==-1}function f(n){var i,t;if(typeof n!="string"||(n=n.replace(/ .+$/,""),i=n.split("/"),i.length!==8))return!1;for(t=0;t<8;t++)if(i[t]===""||i[t].length>8||i[t].search(/[^kqrbnpKQRNBP1-8]/)!==-1)return!1;return!0}function i(t){if(typeof t!="object")return!1;for(var i in t)if(t.hasOwnProperty(i)===!0&&(n(i)!==!0||o(t[i])!==!0))return!1;return!0}function s(n){return n.toLowerCase()===n?"b"+n.toUpperCase():"w"+n.toUpperCase()}function h(n){var t=n.split("");return t[0]==="w"?t[1].toUpperCase():t[1].toLowerCase()}function r(n){var u,r,e,i,c,l;if(f(n)!==!0)return!1;n=n.replace(/ .+$/,"");var a=n.split("/"),o={},h=8;for(u=0;u<8;u++){for(r=a[u].split(""),e=0,i=0;i<r.length;i++)r[i].search(/[1-8]/)!==-1?(c=parseInt(r[i],10),e+=c):(l=t[e]+h,o[l]=s(r[i]),e++);h--}return o}function u(n){var r,e,u,f,o;if(i(n)!==!0)return!1;for(r="",e=8,u=0;u<8;u++){for(f=0;f<8;f++)o=t[f]+e,r+=n.hasOwnProperty(o)===!0?h(n[o]):"1";u!==7&&(r+="/");e--}return r=r.replace(/11111111/g,"8"),r=r.replace(/1111111/g,"7"),r=r.replace(/111111/g,"6"),r=r.replace(/11111/g,"5"),r=r.replace(/1111/g,"4"),r=r.replace(/111/g,"3"),r.replace(/11/g,"2")}var t="abcdefgh".split("");window.ChessBoard=window.ChessBoard||function(o,s){function rt(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(){var n=Math.random()*16|0;return n.toString(16)})}function l(n){return JSON.parse(JSON.stringify(n))}function ii(n){var t=n.split(".");return{major:parseInt(t[0],10),minor:parseInt(t[1],10),patch:parseInt(t[2],10)}}function hi(n,t){n=ii(n);t=ii(t);var i=n.major*1e8+n.minor*1e4+n.patch,r=t.major*1e8+t.minor*1e4+t.patch;return i>=r}function ut(n,t,i){if(s.hasOwnProperty("showErrors")===!0&&s.showErrors!==!1){var r="ChessBoard Error "+n+": "+t;if(s.showErrors==="console"&&typeof console=="object"&&typeof console.log=="function"){console.log(r);arguments.length>=2&&console.log(i);return}if(s.showErrors==="alert"){i&&(r+="\n\n"+JSON.stringify(i));window.alert(r);return}typeof s.showErrors=="function"&&s.showErrors(n,t,i)}}function ci(){if(typeof o=="string"){if(o==="")return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var n=document.getElementById(o);if(!n)return window.alert('ChessBoard Error 1002: Element with id "'+o+'" does not exist in the DOM.\n\nExiting...'),!1;y=$(n)}else if(y=$(o),y.length!==1)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;return!window.JSON||typeof JSON.stringify!="function"||typeof JSON.parse!="function"?(window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1):(typeof $&&$.fn&&$.fn.jquery&&hi($.fn.jquery,dt)===!0)?!0:(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+dt+" or higher on the page.\n\nExiting..."),!1)}function st(n){return n==="fast"||n==="slow"?!0:parseInt(n,10)+""!=n+""?!1:n>=0}function li(){return(typeof s=="string"||i(s)===!0)&&(s={position:s}),s.orientation!=="black"&&(s.orientation="white"),b=s.orientation,s.showNotation!==!1&&(s.showNotation=!0),s.draggable!==!0&&(s.draggable=!1),s.dropOffBoard!=="trash"&&(s.dropOffBoard="snapback"),s.sparePieces!==!0&&(s.sparePieces=!1),s.sparePieces===!0&&(s.draggable=!0),(s.hasOwnProperty("pieceTheme")!==!0||typeof s.pieceTheme!="string"&&typeof s.pieceTheme!="function")&&(s.pieceTheme="Content/Images/chesspieces/{piece}.png"),(s.hasOwnProperty("appearSpeed")!==!0||st(s.appearSpeed)!==!0)&&(s.appearSpeed=200),(s.hasOwnProperty("moveSpeed")!==!0||st(s.moveSpeed)!==!0)&&(s.moveSpeed=200),(s.hasOwnProperty("snapbackSpeed")!==!0||st(s.snapbackSpeed)!==!0)&&(s.snapbackSpeed=50),(s.hasOwnProperty("snapSpeed")!==!0||st(s.snapSpeed)!==!0)&&(s.snapSpeed=25),(s.hasOwnProperty("trashSpeed")!==!0||st(s.trashSpeed)!==!0)&&(s.trashSpeed=100),s.hasOwnProperty("position")===!0&&(s.position==="start"?c=l(gt):f(s.position)===!0?c=r(s.position):i(s.position)===!0?c=l(s.position):ut(7263,"Invalid value passed to config.position.",s.position)),!0}function ai(){var t=parseInt(y.css("width"),10),n;if(!t||t<=0)return 0;for(n=t;n%8!=0&&n>0;)n--;return n/8}function vi(){for(var i,u,r,f,e,n=0;n<t.length;n++)for(i=1;i<=8;i++)u=t[n]+i,v[u]=u+"-"+rt();for(r="KQRBNP".split(""),n=0;n<r.length;n++)f="w"+r[n],e="b"+r[n],et[f]=f+"-"+rt(),et[e]=e+"-"+rt()}function yi(){var n='<div class="'+h.chessboard+'">';return s.sparePieces===!0&&(n+='<div class="'+h.sparePieces+" "+h.sparePiecesTop+'"><\/div>'),n+='<div class="'+h.board+'"><\/div>',s.sparePieces===!0&&(n+='<div class="'+h.sparePieces+" "+h.sparePiecesBottom+'"><\/div>'),n+='<div class="'+h.promoteModal+'"><\/div>',n+='<div class="'+h.promoteModalBg+'"><\/div>',n+"<\/div>"}function pi(n){var i,o,f,e;n!=="black"&&(n="white");var r="",s=l(t),u=8;for(n==="black"&&(s.reverse(),u=1),i="white",o=0;o<8;o++){for(r+='<div class="'+h.row+'">',f=0;f<8;f++)e=s[f]+u,r+='<div class="'+h.square+" "+h[i]+" square-"+e+'" style="width: '+p+"px; height: "+p+'px" id="'+v[e]+'" data-square="'+e+'">',r+="<\/div>",i=i==="white"?"black":"white";r+='<div class="'+h.clearfix+'"><\/div><\/div>';i=i==="white"?"black":"white";n==="white"?u--:u++}return r}function ri(n){return typeof s.pieceTheme=="function"?s.pieceTheme(n):typeof s.pieceTheme=="string"?s.pieceTheme.replace(/{piece}/g,n):(ut(8272,"Unable to build image source for cfg.pieceTheme."),"")}function nt(n,t,i){var r='<img src="'+ri(n)+'" ';return i&&typeof i=="string"&&(r+='id="'+i+'" '),r+='alt="" class="'+h.piece+'" data-piece="'+n+'" style="width: '+p+"px;height: "+p+"px;",t===!0&&(r+="display:none;"),r+'" />'}function ct(n){var i=["wK","wQ","wR","wB","wN","wP"],r,t;for(n==="black"&&(i=["bK","bQ","bR","bB","bN","bP"]),r="",t=0;t<i.length;t++)r+=nt(i[t],!1,et[i[t]]);return r}function wi(n){var i=["wQ","wR","wB","wN"],r,t;for(n==="black"&&(i=["bQ","bR","bB","bN"]),r="",t=0;t<i.length;t++)r+=nt(i[t],!1,et[i[t]]);return r}function bi(){ht.toggleClass("active",!0);wt.toggleClass("active",!0)}function ki(n){ht.toggleClass("active",!1);wt.toggleClass("active",!1);s.promoteDisplay=null;s.promoteCallback&&(s.promoteCallback(n),s.promoteCallback=null)}function di(n,t,i,r){var f=$("#"+v[n]),e=f.offset(),o=$("#"+v[t]),y=o.offset(),c=rt(),u,l,a;$("body").append(nt(i,!0,c));u=$("#"+c);u.css({display:"",position:"absolute",top:e.top,left:e.left});f.find("."+h.piece).remove();l=function(){o.append(nt(i));u.remove();typeof r=="function"&&r()};a={duration:s.moveSpeed,complete:l};u.animate(y,a)}function gi(n,t,i){var f=$("#"+et[n]).offset(),u=$("#"+v[t]),l=u.offset(),e=rt(),r,o,c;$("body").append(nt(n,!0,e));r=$("#"+e);r.css({display:"",position:"absolute",left:f.left,top:f.top});o=function(){u.find("."+h.piece).remove();u.append(nt(n));r.remove();typeof i=="function"&&i()};c={duration:s.moveSpeed,complete:o};r.animate(l,c)}function nr(n,t,i){function u(){if((f++,f===n.length)&&(ft(),ni=!1,s.hasOwnProperty("onMoveEnd")===!0&&typeof s.onMoveEnd=="function"))s.onMoveEnd(l(t),l(i))}var f,r;for(ni=!0,f=0,r=0;r<n.length;r++)n[r].type==="clear"&&$("#"+v[n[r].square]+" ."+h.piece).fadeOut(s.trashSpeed,u),n[r].type==="add"&&s.sparePieces!==!0&&$("#"+v[n[r].square]).append(nt(n[r].piece,!0)).find("."+h.piece).fadeIn(s.appearSpeed,u),n[r].type==="add"&&s.sparePieces===!0&&gi(n[r].piece,n[r].square,u),n[r].type==="move"&&di(n[r].source,n[r].destination,n[r].piece,u)}function tr(n,i){var r,u;n=n.split("");r=t.indexOf(n[0])+1;u=parseInt(n[1],10);i=i.split("");var o=t.indexOf(i[0])+1,s=parseInt(i[1],10),f=Math.abs(r-o),e=Math.abs(u-s);return f>=e?f:e}function ir(n){for(var u,f,e,r=[],i=0;i<8;i++)for(u=0;u<8;u++)(f=t[i]+(u+1),n!==f)&&r.push({square:f,distance:tr(n,f)});for(r.sort(function(n,t){return n.distance-t.distance}),e=[],i=0;i<r.length;i++)e.push(r[i].square);return e}function rr(n,t,i){for(var r,f=ir(i),u=0;u<f.length;u++)if(r=f[u],n.hasOwnProperty(r)===!0&&n[r]===t)return r;return!1}function ur(n,t){var r,f,u,i;n=l(n);t=l(t);r=[];f={};for(i in t)t.hasOwnProperty(i)===!0&&n.hasOwnProperty(i)===!0&&n[i]===t[i]&&(delete n[i],delete t[i]);for(i in t)t.hasOwnProperty(i)===!0&&(u=rr(n,t[i],i),u!==!1&&(r.push({type:"move",source:u,destination:i,piece:t[i]}),delete n[u],delete t[i],f[i]=!0));for(i in t)t.hasOwnProperty(i)===!0&&(r.push({type:"add",square:i,piece:t[i]}),delete t[i]);for(i in n)n.hasOwnProperty(i)===!0&&f.hasOwnProperty(i)!==!0&&(r.push({type:"clear",square:i,piece:n[i]}),delete n[i]);return r}function ft(){for(var n in c)c.hasOwnProperty(n)===!0&&(k&&w===n||$("#"+v[n]).html(nt(c[n])))}function lt(){g.html(pi(b));ft();s.promoteDisplay&&(ht.html(wi(s.promoteDisplay)),$("img").bind("click",function(n){var t=n.target.getAttribute("data-piece");ki(t[1].toLowerCase())}));s.sparePieces===!0&&(b==="white"?(yt.html(ct("black")),pt.html(ct("white"))):(yt.html(ct("white")),pt.html(ct("black"))))}function fr(n,t){var i,r;n=l(n);for(i in t)t.hasOwnProperty(i)===!0&&n.hasOwnProperty(i)===!0&&(r=n[i],delete n[i],n[t[i]]=r);return n}function at(n){var t=l(c),i=l(n),r=u(t),f=u(i);if(r!==f){if(s.hasOwnProperty("onChange")===!0&&typeof s.onChange=="function")s.onChange(t,i);c=n}}function bt(n,t){var r,i;for(r in ot)if(ot.hasOwnProperty(r)===!0&&(i=ot[r],n>=i.left&&n<i.left+p&&t>=i.top&&t<i.top+p))return r;return"offboard"}function er(){ot={};for(var n in v)v.hasOwnProperty(n)===!0&&(ot[n]=$("#"+v[n]).offset())}function kt(){g.find("."+h.square).removeClass(h.highlight1+" "+h.highlight2)}function or(){function n(){if(ft(),d.css("display","none"),s.hasOwnProperty("onSnapbackEnd")===!0&&typeof s.onSnapbackEnd=="function")s.onSnapbackEnd(tt,w,l(c),b)}if(w==="spare"){ui();return}kt();var t=$("#"+v[w]).offset(),i={duration:s.snapbackSpeed,complete:n};d.animate(t,i);k=!1}function ui(){kt();var n=l(c);delete n[w];at(n);ft();d.fadeOut(s.trashSpeed);k=!1}function sr(n){var t;kt();t=l(c);delete t[w];t[n]=tt;at(t);var i=$("#"+v[n]).offset(),r=function(){if(ft(),d.css("display","none"),s.hasOwnProperty("onSnapEnd")===!0&&typeof s.onSnapEnd=="function")s.onSnapEnd(w,n,tt)},u={duration:s.snapSpeed,complete:r};d.animate(i,u);k=!1}function vt(n,t,i,r){(typeof s.onDragStart!="function"||s.onDragStart(n,t,l(c),b)!==!1)&&(k=!0,tt=t,w=n,it=n==="spare"?"offboard":n,er(),d.attr("src",ri(t)).css({display:"",position:"absolute",left:i-p/2,top:r-p/2}),n!=="spare"&&$("#"+v[n]).addClass(h.highlight1).find("."+h.piece).css("display","none"))}function fi(t,i){d.css({left:t-p/2,top:i-p/2});var r=bt(t,i);if(r!==it){if(n(it)===!0&&$("#"+v[it]).removeClass(h.highlight2),n(r)===!0&&$("#"+v[r]).addClass(h.highlight2),typeof s.onDragMove=="function")s.onDragMove(r,it,w,tt,l(c),b);it=r}}function ei(t){var i="drop",r,f,u;t==="offboard"&&s.dropOffBoard==="snapback"&&(i="snapback");t==="offboard"&&s.dropOffBoard==="trash"&&(i="trash");s.hasOwnProperty("onDrop")===!0&&typeof s.onDrop=="function"&&(r=l(c),w==="spare"&&n(t)===!0&&(r[t]=tt),n(w)===!0&&t==="offboard"&&delete r[w],n(w)===!0&&n(t)===!0&&(delete r[w],r[t]=tt),f=l(c),u=s.onDrop(w,t,tt,r,f,b),(u==="snapback"||u==="trash")&&(i=u));i==="snapback"?or():i==="trash"?ui():i==="drop"&&sr(t)}function hr(){return"ontouchstart"in document.documentElement}function cr(){return navigator&&navigator.userAgent&&navigator.userAgent.search(/MSIE/)!==-1}function lr(n){n.preventDefault()}function ar(t){if(s.draggable===!0){var i=$(this).attr("data-square");n(i)===!0&&c.hasOwnProperty(i)===!0&&vt(i,c[i],t.pageX,t.pageY)}}function vr(t){if(s.draggable===!0){var i=$(this).attr("data-square");n(i)===!0&&c.hasOwnProperty(i)===!0&&(t=t.originalEvent,vt(i,c[i],t.changedTouches[0].pageX,t.changedTouches[0].pageY))}}function yr(n){if(s.sparePieces===!0){var t=$(this).attr("data-piece");vt("spare",t,n.pageX,n.pageY)}}function pr(n){if(s.sparePieces===!0){var t=$(this).attr("data-piece");n=n.originalEvent;vt("spare",t,n.changedTouches[0].pageX,n.changedTouches[0].pageY)}}function oi(n){k===!0&&fi(n.pageX,n.pageY)}function wr(n){k===!0&&(n.preventDefault(),fi(n.originalEvent.changedTouches[0].pageX,n.originalEvent.changedTouches[0].pageY))}function si(n){if(k===!0){var t=bt(n.pageX,n.pageY);ei(t)}}function br(n){if(k===!0){var t=bt(n.originalEvent.changedTouches[0].pageX,n.originalEvent.changedTouches[0].pageY);ei(t)}}function kr(t){var i,r;if(k===!1&&s.hasOwnProperty("onMouseoverSquare")===!0&&typeof s.onMouseoverSquare=="function"&&(i=$(t.currentTarget).attr("data-square"),n(i)===!0)){r=!1;c.hasOwnProperty(i)===!0&&(r=c[i]);s.onMouseoverSquare(i,r,l(c),b)}}function dr(t){var i,r;if(k===!1&&s.hasOwnProperty("onMouseoutSquare")===!0&&typeof s.onMouseoutSquare=="function"&&(i=$(t.currentTarget).attr("data-square"),n(i)===!0)){r=!1;c.hasOwnProperty(i)===!0&&(r=c[i]);s.onMouseoutSquare(i,r,l(c),b)}}function gr(){$("body").on("mousedown mousemove","."+h.piece,lr);g.on("mousedown","."+h.square,ar);y.on("mousedown","."+h.sparePieces+" ."+h.piece,yr);g.on("mouseenter","."+h.square,kr);g.on("mouseleave","."+h.square,dr);if(cr()===!0){document.ondragstart=function(){return!1};$("body").on("mousemove",oi);$("body").on("mouseup",si)}else{$(window).on("mousemove",oi);$(window).on("mouseup",si)}if(hr()===!0){g.on("touchstart","."+h.square,vr);y.on("touchstart","."+h.sparePieces+" ."+h.piece,pr);$(window).on("touchmove",wr);$(window).on("touchend",br)}}function nu(){y.html(yi());g=y.find("."+h.board);ht=y.find("."+h.promoteModal);wt=y.find("."+h.promoteModalBg);s.sparePieces===!0&&(yt=y.find("."+h.sparePiecesTop),pt=y.find("."+h.sparePiecesBottom));var n=rt();$("body").append(nt("wP",!0,n));d=$("#"+n);ti=parseInt(g.css("borderLeftWidth"),10);a.resize()}function tu(){ci()===!0&&li()===!0&&(vi(),nu(),gr())}s=s||{};var dt="1.7.0",gt=r("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),h={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7",promoteModalBg:"promote-background-1212",promoteModal:"promote-modal-1212"},y,g,d,yt,pt,ht,wt,a={},ni=!1,ti=2,b="white",c={},p,tt,it,w,k=!1,et={},v={},ot;return a.clear=function(n){a.position({},n)},a.set=function(n,t){s.hasOwnProperty(n)?s[n]=t:ut(1e3,"Invalid config key.",n)},a.destroy=function(){y.html("");d.remove();y.unbind()},a.fen=function(){return a.position("fen")},a.flip=function(){a.orientation("flip")},a.move=function(){var t,i,n,r,u;if(arguments.length!==0){for(t=!0,i={},n=0;n<arguments.length;n++){if(arguments[n]===!1){t=!1;continue}if(e(arguments[n])!==!0){ut(2826,"Invalid move passed to the move method.",arguments[n]);continue}r=arguments[n].split("-");i[r[0]]=r[1]}return u=fr(c,i),a.position(u,t),u}},a.orientation=function(n){if(arguments.length===0)return b;if(n==="white"||n==="black"){b=n;lt();return}if(n==="flip"){b=b==="white"?"black":"white";lt();return}ut(5482,"Invalid value passed to the orientation method.",n)},a.position=function(n,t){if(arguments.length===0)return l(c);if(typeof n=="string"&&n.toLowerCase()==="fen")return u(c);if(t!==!1&&(t=!0),typeof n=="string"&&n.toLowerCase()==="start"&&(n=l(gt)),f(n)===!0&&(n=r(n)),i(n)!==!0){ut(6482,"Invalid value passed to the position method.",n);return}t===!0?(nr(ur(c,n),c,n),at(n)):(at(n),ft())},a.resize=function(){p=ai();g.css("width",p*8+"px");d.css({height:p,width:p});s.sparePieces===!0&&y.find("."+h.sparePieces).css("paddingLeft",p+ti+"px");lt()},a.start=function(n){a.position("start",n)},a.choosePromotion=function(n,t){s.promoteDisplay=n;s.promoteCallback=t;bi();lt()},tu(),a};window.ChessBoard.fenToObj=r;window.ChessBoard.objToFen=u})();
/*! Copyright (c) 2014, Jeff Hlywa (jhlywa@gmail.com)
 *  Released under the BSD license
 *  https://github.com/jhlywa/chess.js/blob/master/LICENSE
 */
var Chess=function(n){function ei(){t=new Array(128);e={w:c,b:c};f=h;u={w:0,b:0};l=c;a=0;tt=1;k=[];o={};ht(it())}function oi(){st(vt)}function st(n){var t=n.split(/\s+/),p=t[0],o=0,b=ri+"12345678/",y,e,w;if(!si(n).valid)return!1;for(ei(),y=0;y<p.length;y++)e=p.charAt(y),e==="/"?o+=8:fr(e)?o+=parseInt(e,10):(w=e<"a"?h:v,ci({type:e.toLowerCase(),color:w},s(o)),o++);return f=t[1],t[2].indexOf("K")>-1&&(u.w|=i.KSIDE_CASTLE),t[2].indexOf("Q")>-1&&(u.w|=i.QSIDE_CASTLE),t[2].indexOf("k")>-1&&(u.b|=i.KSIDE_CASTLE),t[2].indexOf("q")>-1&&(u.b|=i.QSIDE_CASTLE),l=t[3]==="-"?c:r[t[3]],a=parseInt(t[4],10),tt=parseInt(t[5],10),ht(it()),!0}function si(n){var t={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large]."},i=n.split(/\s+/),r,u,e,o,f;if(i.length!==6)return{valid:!1,error_number:1,error:t[1]};if(isNaN(i[5])||parseInt(i[5],10)<=0)return{valid:!1,error_number:2,error:t[2]};if(isNaN(i[4])||parseInt(i[4],10)<0)return{valid:!1,error_number:3,error:t[3]};if(!/^(-|[abcdefgh][36])$/.test(i[3]))return{valid:!1,error_number:4,error:t[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(i[2]))return{valid:!1,error_number:5,error:t[5]};if(!/^(w|b)$/.test(i[1]))return{valid:!1,error_number:6,error:t[6]};if(r=i[0].split("/"),r.length!==8)return{valid:!1,error_number:7,error:t[7]};for(u=0;u<r.length;u++){for(e=0,o=!1,f=0;f<r[u].length;f++)if(isNaN(r[u][f])){if(!/^[prnbqkPRNBQK]$/.test(r[u][f]))return{valid:!1,error_number:9,error:t[9]};e+=1;o=!1}else{if(o)return{valid:!1,error_number:8,error:t[8]};e+=parseInt(r[u][f],10);o=!0}if(e!==8)return{valid:!1,error_number:10,error:t[10]}}return{valid:!0,error_number:0,error:t[0]}}function it(){for(var w,p,e,b,o=0,y="",n=r.a8;n<=r.h1;n++)t[n]==null?o++:(o>0&&(y+=o,o=0),w=t[n].color,p=t[n].type,y+=w===h?p.toUpperCase():p.toLowerCase()),n+1&136&&(o>0&&(y+=o),n!==r.h1&&(y+="/"),o=0,n+=8);return e="",u[h]&i.KSIDE_CASTLE&&(e+="K"),u[h]&i.QSIDE_CASTLE&&(e+="Q"),u[v]&i.KSIDE_CASTLE&&(e+="k"),u[v]&i.QSIDE_CASTLE&&(e+="q"),e=e||"-",b=l===c?"-":s(l),[y,f,e,b,a,tt].join(" ")}function pt(n){for(var t=0;t<n.length;t+=2)typeof n[t]=="string"&&typeof n[t+1]=="string"&&(o[n[t]]=n[t+1]);return o}function ht(n){k.length>0||(n!==vt?(o.SetUp="1",o.FEN=n):(delete o.SetUp,delete o.FEN))}function hi(n){var i=t[r[n]];return i?{type:i.type,color:i.color}:null}function ci(n,i){if(!("type"in n&&"color"in n)||ri.indexOf(n.type.toLowerCase())===-1||!(i in r))return!1;var u=r[i];return n.type==ft&&!(e[n.color]==c||e[n.color]==u)?!1:(t[u]={type:n.type,color:n.color},n.type===ft&&(e[n.color]=u),ht(it()),!0)}function tr(n){var i=hi(n);return t[r[n]]=null,i&&i.type===ft&&(e[i.color]=c),ht(it()),i}function li(n,t,r,u,e){var o={color:f,from:t,to:r,flags:u,piece:n[t].type};return e&&(o.flags|=i.PROMOTION,o.promotion=e),n[r]?o.captured=n[r].type:u&i.EP_CAPTURE&&(o.captured=y),o}function d(n){function v(n,t,i,r,u){var e,f,o;if(n[i].type===y&&(b(r)===nr||b(r)===ki))for(e=[ii,ti,ut,at],f=0,o=e.length;f<o;f++)t.push(li(n,i,r,u,e[f]));else t.push(li(n,i,r,u))}var c=[],h=f,d=ot(h),ct={b:gi,w:di},et=r.a8,rt=r.h1,st=!1,lt=typeof n!="undefined"&&"legal"in n?n.legal:!0,w,k,ht,s,a,tt,ft,o,it;if(typeof n!="undefined"&&"square"in n)if(n.square in r)et=rt=r[n.square],st=!0;else return[];for(o=et;o<=rt;o++){if(o&136){o+=7;continue}if(w=t[o],w!=null&&w.color===h)if(w.type===y)for(s=o+yt[h][0],t[s]==null&&(v(t,c,o,s,i.NORMAL),s=o+yt[h][1],ct[h]===b(o)&&t[s]==null&&v(t,c,o,s,i.BIG_PAWN)),k=2;k<4;k++)(s=o+yt[h][k],s&136)||(t[s]!=null&&t[s].color===d?v(t,c,o,s,i.CAPTURE):s===l&&v(t,c,o,l,i.EP_CAPTURE));else for(k=0,it=ui[w.type].length;k<it;k++)for(ht=ui[w.type][k],s=o;;){if(s+=ht,s&136)break;if(t[s]==null)v(t,c,o,s,i.NORMAL);else{if(t[s].color===h)break;v(t,c,o,s,i.CAPTURE);break}if(w.type==="n"||w.type==="k")break}}if(st&&rt!==e[h]||(u[h]&i.KSIDE_CASTLE&&(a=e[h],tt=a+2,t[a+1]!=null||t[tt]!=null||g(d,e[h])||g(d,a+1)||g(d,tt)||v(t,c,e[h],tt,i.KSIDE_CASTLE)),u[h]&i.QSIDE_CASTLE&&(a=e[h],tt=a-2,t[a-1]!=null||t[a-2]!=null||t[a-3]!=null||g(d,e[h])||g(d,a-1)||g(d,tt)||v(t,c,e[h],tt,i.QSIDE_CASTLE))),!lt)return c;for(ft=[],o=0,it=c.length;o<it;o++)p(c[o]),wt(h)||ft.push(c[o]),nt();return ft}function rt(n){var t="",r;return n.flags&i.KSIDE_CASTLE?t="O-O":n.flags&i.QSIDE_CASTLE?t="O-O-O":(r=rr(n),n.piece!==y&&(t+=n.piece.toUpperCase()+r),n.flags&(i.CAPTURE|i.EP_CAPTURE)&&(n.piece===y&&(t+=s(n.from)[0]),t+="x"),t+=s(n.to),n.flags&i.PROMOTION&&(t+="="+n.promotion.toUpperCase())),p(n),ct()&&(t+=bt()?"#":"+"),nt(),t}function g(n,i){for(var u=r.a8;u<=r.h1;u++){if(u&136){u+=7;continue}if(t[u]!=null&&t[u].color===n){var f=t[u],o=u-i,s=o+119;if(pi[s]&1<<bi[f.type]){if(f.type===y){if(o>0){if(f.color===h)return!0}else if(f.color===v)return!0;continue}if(f.type==="n"||f.type==="k")return!0;for(var c=wi[s],e=u+c,l=!1;e!==i;){if(t[e]!=null){l=!0;break}e+=c}if(!l)return!0}}}return!1}function wt(n){return g(ot(n),e[n])}function ct(){return wt(f)}function bt(){return ct()&&d().length===0}function kt(){return!ct()&&d().length===0}function dt(){for(var u,e,h,i={},o=[],f=0,s=0,n=r.a8;n<=r.h1;n++){if(s=(s+1)%2,n&136){n+=7;continue}u=t[n];u&&(i[u.type]=u.type in i?i[u.type]+1:1,u.type===ut&&o.push(s),f++)}if(f===2||f===3&&(i[ut]===1||i[at]===1))return!0;if(f===i[ut]+2){for(e=0,h=o.length,n=0;n<h;n++)e+=o[n];if(e===0||e===h)return!0}return!1}function gt(){for(var i=[],t={},u=!1,r,n;;){if(r=nt(),!r)break;i.push(r)}for(;;){if(n=it().split(" ").slice(0,4).join(" "),t[n]=n in t?t[n]+1:1,t[n]>=3&&(u=!0),!i.length)break;p(i.pop())}return u}function ir(n){k.push({move:n,kings:{b:e.b,w:e.w},turn:f,castling:{b:u.b,w:u.w},ep_square:l,half_moves:a,move_number:tt})}function p(n){var o=f,s=ot(o),p,h,r,b;if(ir(n),t[n.to]=t[n.from],t[n.from]=null,n.flags&i.EP_CAPTURE&&(f===v?t[n.to-16]=null:t[n.to+16]=null),n.flags&i.PROMOTION&&(t[n.to]={type:n.promotion,color:o}),t[n.to].type===ft&&(e[t[n.to].color]=n.to,n.flags&i.KSIDE_CASTLE?(p=n.to-1,h=n.to+1,t[p]=t[h],t[h]=null):n.flags&i.QSIDE_CASTLE&&(p=n.to+1,h=n.to-2,t[p]=t[h],t[h]=null),u[o]=""),u[o])for(r=0,b=w[o].length;r<b;r++)if(n.from===w[o][r].square&&u[o]&w[o][r].flag){u[o]^=w[o][r].flag;break}if(u[s])for(r=0,b=w[s].length;r<b;r++)if(n.to===w[s][r].square&&u[s]&w[s][r].flag){u[s]^=w[s][r].flag;break}l=n.flags&i.BIG_PAWN?f==="b"?n.to-16:n.to+16:c;n.piece===y?a=0:n.flags&(i.CAPTURE|i.EP_CAPTURE)?a=0:a++;f===v&&tt++;f=ot(f)}function nt(){var r=k.pop(),n,c,s,p,h,o;return r==null?null:(n=r.move,e=r.kings,f=r.turn,u=r.castling,l=r.ep_square,a=r.half_moves,tt=r.move_number,c=f,s=ot(f),t[n.from]=t[n.to],t[n.from].type=n.piece,t[n.to]=null,n.flags&i.CAPTURE?t[n.to]={type:n.captured,color:s}:n.flags&i.EP_CAPTURE&&(p=c===v?n.to-16:n.to+16,t[p]={type:y,color:s}),n.flags&(i.KSIDE_CASTLE|i.QSIDE_CASTLE)&&(n.flags&i.KSIDE_CASTLE?(h=n.to+1,o=n.to-1):n.flags&i.QSIDE_CASTLE&&(h=n.to-2,o=n.to+1),t[h]=t[o],t[o]=null),n)}function rr(n){for(var r=d(),t=n.from,h=n.to,c=n.piece,e=0,o=0,u=0,i=0,l=r.length;i<l;i++){var f=r[i].from,a=r[i].to,v=r[i].piece;c===v&&t!==f&&h===a&&(e++,b(t)===b(f)&&o++,et(t)===et(f)&&u++)}return e>0?o>0&&u>0?s(t):u>0?s(t).charAt(1):s(t).charAt(0):""}function ur(){for(var i="   +------------------------+\n",n=r.a8;n<=r.h1;n++){if(et(n)===0&&(i+=" "+"87654321"[b(n)]+" |"),t[n]==null)i+=" . ";else{var u=t[n].type,f=t[n].color,e=f===h?u.toUpperCase():u.toLowerCase();i+=" "+e+" "}n+1&136&&(i+="|\n",n+=8)}return i+="   +------------------------+\n",i+"     a  b  c  d  e  f  g  h\n"}function b(n){return n>>4}function et(n){return n&15}function s(n){var t=et(n),i=b(n);return"abcdefgh".substring(t,t+1)+"87654321".substring(i,i+1)}function ot(n){return n===h?v:h}function fr(n){return"0123456789".indexOf(n)!==-1}function lt(n){var t=ai(n),r,u;t.san=rt(t);t.to=s(t.to);t.from=s(t.from);r="";for(u in i)i[u]&t.flags&&(r+=fi[u]);return t.flags=r,t}function ai(n){var i=n instanceof Array?[]:{};for(var t in n)i[t]=typeof t=="object"?ai(n[t]):n[t];return i}function ni(n){return n.replace(/^\s+|\s+$/g,"")}function vi(n){for(var u,r=d({legal:!1}),t=0,e=f,i=0,o=r.length;i<o;i++)p(r[i]),wt(e)||(n-1>0?(u=vi(n-1),t+=u):t++),nt();return t}var v="b",h="w",c=-1,y="p",at="n",ut="b",ti="r",ii="q",ft="k",ri="pnbrqkPNBRQK",vt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",yi=["1-0","0-1","1/2-1/2","*"],yt={b:[16,32,17,15],w:[-16,-32,-17,-15]},ui={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},pi=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],wi=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],bi={p:0,n:1,b:2,r:3,q:4,k:5},fi={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},i={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},ki=7,di=6,gi=1,nr=0,r={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},w={w:[{square:r.a1,flag:i.QSIDE_CASTLE},{square:r.h1,flag:i.KSIDE_CASTLE}],b:[{square:r.a8,flag:i.QSIDE_CASTLE},{square:r.h8,flag:i.KSIDE_CASTLE}]},t=new Array(128),e={w:c,b:c},f=h,u={w:0,b:0},l=c,a=0,tt=1,k=[],o={};return typeof n=="undefined"?st(vt):st(n),{WHITE:h,BLACK:v,PAWN:y,KNIGHT:at,BISHOP:ut,ROOK:ti,QUEEN:ii,KING:ft,SQUARES:function(){for(var t=[],n=r.a8;n<=r.h1;n++){if(n&136){n+=7;continue}t.push(s(n))}return t}(),FLAGS:fi,getBoard:function(){return t},load:function(n){return st(n)},reset:function(){return oi()},moves:function(n){for(var i=d(n),r=[],t=0,u=i.length;t<u;t++)typeof n!="undefined"&&"verbose"in n&&n.verbose?r.push(lt(i[t])):r.push(rt(i[t]));return r},in_check:function(){return ct()},in_checkmate:function(){return bt()},in_stalemate:function(){return kt()},in_draw:function(){return a>=100||kt()||dt()||gt()},insufficient_material:function(){return dt()},in_threefold_repetition:function(){return gt()},game_over:function(){return a>=100||bt()||kt()||dt()||gt()},validate_fen:function(n){return si(n)},fen:function(){return it()},pgn:function(n){var c=typeof n=="object"&&typeof n.newline_char=="string"?n.newline_char:"\n",l=typeof n=="object"&&typeof n.max_width=="number"?n.max_width:0,t=[],a=!1,s,f,e;for(var i in o)t.push("["+i+' "'+o[i]+'"]'+c),a=!0;for(a&&k.length&&t.push(c),s=[];k.length>0;)s.push(nt());for(var r=[],u="",h=1;s.length>0;)f=s.pop(),h===1&&f.color==="b"?(u="1. ...",h++):f.color==="w"&&(u.length&&r.push(u),u=h+".",h++),u=u+" "+rt(f),p(f);if(u.length&&r.push(u),typeof o.Result!="undefined"&&r.push(o.Result),l===0)return t.join("")+r.join(" ");for(e=0,i=0;i<r.length;i++)e+r[i].length>l&&i!==0?(t[t.length-1]===" "&&t.pop(),t.push(c),e=0):i!==0&&(t.push(" "),e++),t.push(r[i]),e+=r[i].length;return t.join("")},load_pgn:function(n,t){function f(n){return n.replace(/\\/g,"\\")}function v(n){for(var r=n.replace(/[+#?!=]/,""),i=d(),t=0,u=i.length;t<u;t++)if(r==rt(i[t]).replace(/[+#?!=]/,""))return i[t];return null}function a(n){return v(ni(n))}function y(n){var t=!1;for(var i in n)t=!0;return t}function w(n,t){for(var s=typeof t=="object"&&typeof t.newline_char=="string"?t.newline_char:"\r?\n",e={},r=n.split(new RegExp(f(s))),u="",o="",i=0;i<r.length;i++)u=r[i].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),o=r[i].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),ni(u).length>0&&(e[u]=o);return e}var e=typeof t=="object"&&typeof t.newline_char=="string"?t.newline_char:"\r?\n",b=new RegExp("^(\\[(.|"+f(e)+")*\\])("+f(e)+")*1.("+f(e)+"|.)*$","g"),s=n.replace(b,"$1"),c,l,u,r,i,h;s[0]!=="["&&(s="");oi();c=w(s,t);for(l in c)pt([l,c[l]]);for(u=n.replace(s,"").replace(new RegExp(f(e),"g")," "),u=u.replace(/(\{[^}]+\})+?/g,""),u=u.replace(/\d+\./g,""),r=ni(u).split(new RegExp(/\s+/)),r=r.join(",").replace(/,,+/g,",").split(","),i="",h=0;h<r.length-1;h++){if(i=a(r[h]),i==null)return!1;p(i)}if(i=r[r.length-1],yi.indexOf(i)>-1)y(o)&&typeof o.Result=="undefined"&&pt(["Result",i]);else{if(i=a(i),i==null)return!1;p(i)}return!0},header:function(){return pt(arguments)},ascii:function(){return ur()},turn:function(){return f},move:function(n){var r=null,i=d(),f,t,u,e;if(typeof n=="string"){for(f=n.replace(/[+#?!=]/,""),t=0,u=i.length;t<u;t++)if(f===rt(i[t]).replace(/[+#?!=]/,"")){r=i[t];break}}else if(typeof n=="object")for(t=0,u=i.length;t<u;t++)if(n.from===s(i[t].from)&&n.to===s(i[t].to)&&(!("promotion"in i[t])||n.promotion===i[t].promotion)){r=i[t];break}return r?(e=lt(r),p(r),e):null},undo:function(){var n=nt();return n?lt(n):null},clear:function(){return ei()},put:function(n,t){return ci(n,t)},get:function(n){return hi(n)},remove:function(n){return tr(n)},perft:function(n){return vi(n)},square_color:function(n){if(n in r){var t=r[n];return(b(t)+et(t))%2==0?"light":"dark"}return null},history:function(n){for(var i=[],r=[],u=typeof n!="undefined"&&("verbose"in n)&&n.verbose,t;k.length>0;)i.push(nt());while(i.length>0)t=i.pop(),u?r.push(lt(t)):r.push(rt(t)),p(t);return r}}};typeof exports!="undefined"&&(exports.Chess=Chess);typeof define!="undefined"&&define(function(){return Chess}),function(){angular.module("nywton.chess",["nywton.chessboard"]).service("NywtonChessGameService",["$log",function(n){this.onDragStart=function(t,i,r,u,f){return(n.debug("lift piece "+r+" from "+i+" - "+u+" - "+f),t.game_over()===!0||t.turn()==="w"&&r.search(/^b/)!==-1||t.turn()==="b"&&r.search(/^w/)!==-1)?!1:!0};this.onDrop=function(n,t,i,r){var e=function(t){return n.move({from:i,to:r,promotion:t})},u,f,o;if(i==r)return"snapback";if(u=n.get(i),u&&u.type=="p"&&(u.color=="w"&&i[1]=="7"||u.color=="b"&&i[1]=="2")){if(f=null,u.color=="w"&&i[1]=="7"?f="white":u.color=="b"&&i[1]=="2"&&(f="black"),f)return t.choosePromotion(f,function(i){e(i);t.position(n.fen())}),"snapback"}else if(o=e("q"),o===null)return"snapback"};this.onSnapEnd=function(t,i,r,u,f){n.debug("onSnapEnd "+f+" from "+r+" to "+u);i.position(t.fen())};this.makeRandomMove=function(t,i){var r,u,f;n.info("position: "+t.fen());r=t.moves();u=r[Math.floor(Math.random()*r.length)];t.move(u);f=!0;i.position(t.fen(),f);n.info("move: "+u)}}]).directive("nywtonChessgame",["$window","$log","NywtonChessGameService",function(n,t,i){return{restrict:"E",template:'<div><nywton-chessboard board="board" position="\'start\'" draggable="true" on-change="onChange" on-drag-start-cb="onDragStart" on-snap-end="onSnapEnd" on-drop="onDrop"><\/nywton-chessboard><\/div>',replace:!1,scope:{name:"@",game:"=",board:"="},controller:["$scope",function(t){var r=t.game=new n.Chess;r.name=t.name||"game"+t.$id;this.game=function(){return t.game};this.board=function(){return t.board};t.onDragStart=function(n,r,u,f){return i.onDragStart(t.game,n,r,u,f)};t.onSnapEnd=function(n,r,u){return i.onSnapEnd(t.game,t.board,n,r,u)};t.onDrop=function(n,r){return i.onDrop(t.game,t.board,n,r)};t.onChange=function(n,i){return t.$parent.onBoardChanged?t.$parent.onBoardChanged(n,i):angular.noop(n,i)}}]}}]).directive("nywtonAllowOnlyLegalMoves",["$window","NywtonChessGameService",function(n,t){return{restrict:"A",priority:1,require:"nywtonChessboard",controller:[function(){var i=new n.Chess;this.onDragStart=function(n,r,u,f){return t.onDragStart(i,n,r,u,f)};this.getOnSnapEndFunc=function(n){return function(r,u,f){return t.onSnapEnd(i,n(),r,u,f)}};this.onDrop=function(n,r){return t.onDrop(i,n,r)};this.onChange=function(){}}],link:function(n,t,i,r){var u=t.controller("nywtonAllowOnlyLegalMoves"),f=function(){return r.board()};r.config_push(["onDragStart",u.onDragStart]);r.config_push(["onSnapEnd",u.getOnSnapEndFunc(f)]);r.config_push(["onDrop",u.onDrop]);r.config_push(["onChange",u.onChange])}}}]).directive("nywtonRandomVsRandom",["$timeout","$window","NywtonChessGameService",function(n,t,i){return{restrict:"A",priority:1,require:"nywtonChessgame",controller:["$scope",function(t){var f=100,r=1e3,u=null;this.setInterval=function(n){r=n>=f?n:r};this.makeRandomMoveDelayedInvocation=function e(t,f){n.cancel(u);u=n(function(){t.game_over()!==!0&&(i.makeRandomMove(t,f),e(t,f))},r)};t.$on("$destroy",function(){n.cancel(u)})}],link:function(i,r,u,f){var e=r.controller("nywtonRandomVsRandom");u.$observe("interval",function(n){if(n){var i=t.parseInt(n);i===i&&angular.isNumber(i)&&e.setInterval(i)}});i.$watch(function(){return f.game()&&f.game().game_over()},function(t,i){(i===!1&&t===!1||t===!1&&i===!0)&&n(function(){var n=f.game(),t=f.board();e.makeRandomMoveDelayedInvocation(n,t)},0)})}}}]).directive("nywtonChessAutoresize",["$window","$timeout",function(n,t){return{restrict:"A",priority:1,require:"nywtonChessgame",link:function(i,r,u,f){var o=function(){angular.isDefined(f.board())&&f.board().resize()},e;angular.element(n).bind("resize",function(){t.cancel(e);e=t(o,113)});i.$on("$destroy",function(){t.cancel(e)})}}}])}(),function(){angular.module("nywton.chessboard",[]).value("nywtonChessboardDefaultConfig",{position:undefined,showNotation:!0,orientation:"white",draggable:!1,dropOffBoard:"snapback",appearSpeed:200,moveSpeed:200,snapbackSpeed:50,snapSpeed:25,trashSpeed:100,sparePieces:!1,showErrors:!1,pieceTheme:undefined,onDragStart:angular.noop,onDrop:angular.noop,onSnapEnd:angular.noop,onChange:angular.noop,onDragMove:angular.noop,onSnapbackEnd:angular.noop,onMoveEnd:angular.noop,onMouseoutSquare:angular.noop,onMouseoverSquare:angular.noop}).provider("nywtonChessboardConfig",[function(){var n={};this.pieceTheme=function(t){return n.pieceTheme=t,this};this.position=function(t){return n.position=t,this};this.draggable=function(t){return n.draggable=t,this};this.sparePieces=function(t){return n.sparePieces=t,this};this.$get=["nywtonChessboardDefaultConfig",function(t){return angular.extend(t,n)}]}]).config(["nywtonChessboardConfigProvider",function(n){n.position("empty")}]).directive("nywtonChessboard",["$window","$log","$timeout","nywtonChessboardConfig",function(n,t,i,r){var u=["draggable","dropOffBoard","position","orientation","showNotation","sparePieces","showErrors","pieceTheme","appearSpeed","moveSpeed","snapbackSpeed","snapSpeed","trashSpeed",],f=["onChange","onDragStart","onDragMove","onDrop","onSnapbackEnd","onMoveEnd","onMouseoutSquare","onMouseoverSquare","onSnapEnd",];return{restrict:"EA",scope:{name:"@",board:"=",onChange:"&",onDragMove:"&",onDrop:"&",onSnapbackEnd:"&",onMoveEnd:"&",onMouseoutSquare:"&",onMouseoverSquare:"&",onSnapEnd:"&",onDragStart:"&onDragStartCb"},priority:1e3,template:"<div><\/div>",controller:["$scope",function(n){var i=this,u=[];n.name=n.name||"board"+n.$id;this.config_push=function(n){angular.isArray(n)&&n.length===2&&angular.isString(n[0])&&!angular.isUndefined(n[1])&&u.push(n)};this.config=function(){var i={},n;return angular.forEach(u,function(n){i[n[0]]=n[1]}),n=angular.extend(angular.copy(r),i),t.debug(n),n};this.board=function(){return n.board};var e=function(){return n.$$phase||n.$root.$$phase?0:n.$parent.$digest()},o=function(n,t){return n.$$phase||n.$root.$$phase?t():n.$apply(t)},s=!0,h=function(t){return function(){var i=arguments;return o(n.$parent,function(){return t.apply(this,i)})}};angular.forEach(f,function(t){var r,u;angular.isFunction(n[t])&&(r=n[t](),angular.isFunction(r)?(u=s?h(r):r,i.config_push([t,u])):i.config_push([t,e]))})}],link:function(i,r,f,e){angular.forEach(u,function(n){t.debug("attr: "+n+" = "+i.$eval(f[n]));f.hasOwnProperty(n)&&e.config_push([n,i.$eval(f[n])])});var s=e.config(),o=angular.element("<div><\/div>");r.prepend(o);i.board=new n.ChessBoard(o,s);i.board.name=i.name||"board"+i.$id;i.$on("$destroy",function(){i.board.destroy()})}}}]).directive("nywtonPositionRuyLopez",[function(){return{restrict:"A",priority:1,require:"nywtonChessboard",link:function(n,t,i,r){r.config_push(["position","r1bqkbnr/pppp1ppp/2n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R"])}}}]).directive("nywtonPositionStart",[function(){return{restrict:"A",priority:1,require:"nywtonChessboard",link:function(n,t,i,r){r.config_push(["position","start"])}}}]).directive("nywtonChessboardAutoresize",["$window","$timeout",function(n,t){return{restrict:"A",priority:1,require:"nywtonChessboard",link:function(i,r,u,f){var o=function(){angular.isDefined(f.board())&&f.board().resize()},e;angular.element(n).bind("resize",function(){t.cancel(e);e=t(o,113)});i.$on("$destroy",function(){t.cancel(e)})}}}])}();
//# sourceMappingURL=app.min.js.map
